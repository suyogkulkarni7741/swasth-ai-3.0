# Plant Identification Model Integration Guide

## Overview
The "Identify a Plant" page now integrates a client-side TensorFlow.js model for real-time plant classification with instant feedback to users.

## Setup Instructions

### 1. Convert Your `.h5` Model to TFJS Format
The model must be in TensorFlow.js Layers format (`.json` + weight shards) to run in the browser.

Run the conversion script:
```bash
python convert_h5_to_tfjs.py simple_mobilenet_classifier.h5 public/models/simple_mobilenet_classifier
```

This creates:
- `public/models/simple_mobilenet_classifier/model.json` ‚Äì model architecture
- `public/models/simple_mobilenet_classifier/group1-shard*.bin` ‚Äì model weights (may be split into multiple shards)

### 2. Update Labels (Optional but Recommended)
Edit `public/models/simple_mobilenet_classifier/labels.json` to map class indices to plant names:

```json
["Rose", "Sunflower", "Tulip", "Daisy", "Lily", "Lotus"]
```

If you skip this, the page will show generic `class_0`, `class_1`, etc.

### 3. (Optional) Adjust Model Preprocessing
The page currently assumes:
- **Input size:** 224√ó224 pixels (standard for MobileNet)
- **Normalization:** [0, 1] (pixel values √∑ 255)
- **Data format:** RGB

If your model differs, edit these in `src/app/identify-plant/page.tsx`:
- Line with `const inputSize = 224;` ‚Äì change to your model's expected input height/width
- The normalization `input.div(tf.scalar(255))` ‚Äì adjust if using mean/std normalization or [-1,1] range

### 4. Test the Integration
```bash
npm run dev
```
Then visit `http://localhost:3000/identify-plant` and upload a plant image.

---

## Architecture

### Client-Side Flow
1. **Image Upload** ‚Äì user selects a plant image
2. **Model Load** (lazy) ‚Äì `@tensorflow/tfjs` loads `model.json` + weights on first detection
3. **Preprocessing** ‚Äì image is resized to 224√ó224, normalized, and converted to tensor
4. **Inference** ‚Äì model.predict() runs forward pass
5. **Post-processing** ‚Äì softmax applied (if needed), top-3 predictions extracted
6. **Display** ‚Äì confidence bars and plant names shown in real-time

### Files Involved
```
src/app/identify-plant/page.tsx     ‚Üê React component with TFJS integration
public/models/simple_mobilenet_classifier/
  ‚îú‚îÄ‚îÄ model.json                     ‚Üê model architecture
  ‚îú‚îÄ‚îÄ group1-shard*.bin              ‚Üê model weights (generated by converter)
  ‚îî‚îÄ‚îÄ labels.json                    ‚Üê class names (you create/edit)
```

---

## Troubleshooting

### Model fails to load
- Check browser console for exact error (F12 ‚Üí Console tab)
- Ensure `public/models/simple_mobilenet_classifier/model.json` exists
- Verify all `.bin` shard files are present

### Inference produces nonsensical results
- Check input preprocessing (size, normalization)
- Try a different plant image (different lighting, angle, distance)
- Verify model was trained on similar plant images

### Labels show as `class_0`, `class_1`, etc.
- Edit `labels.json` to provide human-readable names
- Ensure JSON array order matches model's output classes

### Performance is slow
- This is normal for the first inference (model download + warmup)
- Subsequent predictions are near-instant (model is cached)
- Use browser DevTools Network tab to see model loading time

---

## Advanced Options

### Use Server-Side Inference Instead
If you prefer Python-based inference (higher accuracy possible with full TensorFlow):
- Replace the TFJS integration with an API call to a Flask/FastAPI backend
- Backend loads the `.h5` directly and runs predictions
- Let me know and I can help set this up

### Fine-tune or Retrain
If accuracy is low:
- Collect more labeled plant images
- Fine-tune the MobileNet base on your dataset
- Export the new model and re-convert to TFJS

---

## Package Dependencies
- `@tensorflow/tfjs` ‚Äì client-side inference
- `tensorflow` (Python) ‚Äì model conversion only (not deployed)
- `tensorflowjs` (Python) ‚Äì conversion utility

Install Python tools once:
```bash
pip install tensorflow tensorflowjs
```

---

## Next Steps
1. Run the conversion script with your `.h5` file
2. Update `labels.json` with your plant classes
3. Start the dev server and test
4. Adjust preprocessing if needed
5. Deploy! üöÄ
